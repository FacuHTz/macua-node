<!-- views/vehiculo.ejs -->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= title %></title>
    <meta
      name="description"
      content="<%= (vehiculo.brand + ' ' + vehiculo.model + ' ' + (vehiculo.year||'')) %> en MACUA. Consultá financiación y disponibilidad."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/vehiculo.css" />
    <!-- OG -->
    <meta property="og:title" content="<%= title %>" />
    <meta property="og:type" content="product" />
    <meta
      property="og:image"
      content="<%= gallery[0] || vehiculo.image || '/assets/img/hero-duster.jpg' %>"
    />
    <meta
      property="og:description"
      content="Consultá precio, cuotas y disponibilidad."
    />
    <meta
      property="og:url"
      content="<%= (PUBLIC_URL || '') + '/vehiculos/' + vehiculo.id %>"
    />
  </head>
  <body>
    <header class="site-header" id="header">
      <div class="container header-row">
        <a href="/" class="brand" aria-label="Inicio">
          <svg
            class="mark"
            width="34"
            height="34"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path d="M12 1 3 12l9 11 9-11-9-11Z" fill="#fff" opacity=".95" />
            <path
              d="M12 4.2 5.2 12 12 19.8 18.8 12 12 4.2Z"
              fill="none"
              stroke="#fff"
              stroke-width="1.5"
            />
          </svg>
          <span class="brand-text">MACUA</span>
        </a>
        <nav class="main-nav" aria-label="Principal">
          <ul>
            <li><a href="/">inicio</a></li>
            <li><a href="/vehiculos" class="active">vehículos</a></li>
            <li><a href="#">renault pro+</a></li>
            <li><a href="#">usados</a></li>
            <li><a href="#contacto">contáctenos</a></li>
          </ul>
        </nav>
        <div class="header-utils">
          <a class="u-btn" href="/vehiculos"><span>volver</span></a>
        </div>
      </div>
    </header>

    <main class="container vehiculo">
      <section class="top">
        <div class="gallery">
          <div class="g-main">
            <img
              id="gMain"
              src="<%= gallery[0] || vehiculo.image || '/assets/img/hero-duster.jpg' %>"
              alt="<%= vehiculo.brand + ' ' + vehiculo.model %>"
            />
          </div>
          <div class="g-thumbs">
            <% (gallery.length ? gallery :
            [vehiculo.image]).filter(Boolean).forEach(function(src, i){ %>
            <button
              class="g-thumb <%= i===0 ? 'active' : '' %>"
              data-src="<%= src %>"
            >
              <img src="<%= src %>" alt="Foto <%= i+1 %>" />
            </button>
            <% }) %>
          </div>
        </div>

        <div class="summary">
          <h1 class="title">
            <%= vehiculo.brand %> <%= vehiculo.model %> <%= vehiculo.year || ''
            %>
          </h1>
          <div class="badges">
            <% if (vehiculo.zero_km) { %><span class="badge">0km</span><% } else
            { %><span class="badge">usado</span><% } %> <% if
            (vehiculo.financing) { %><span class="badge">financiación</span><% }
            %>
          </div>
          <div class="price">
            <span id="price" data-price="<%= vehiculo.price %>"></span>
          </div>
          <ul class="specs">
            <% if (vehiculo.km != null) { %>
            <li>
              <strong>Kilómetros:</strong> <%=
              vehiculo.km.toLocaleString('es-AR') %> km
            </li>
            <% } %> <% if (vehiculo.fuel) { %>
            <li><strong>Combustible:</strong> <%= vehiculo.fuel %></li>
            <% } %> <% if (vehiculo.transmission) { %>
            <li><strong>Transmisión:</strong> <%= vehiculo.transmission %></li>
            <% } %> <% if (vehiculo.body) { %>
            <li><strong>Carrocería:</strong> <%= vehiculo.body %></li>
            <% } %> <% if (vehiculo.location) { %>
            <li><strong>Ubicación:</strong> <%= vehiculo.location %></li>
            <% } %>
          </ul>

          <div class="cta-row">
            <a id="waBtn" class="btn btn-primary" target="_blank" rel="noopener"
              >WhatsApp</a
            >
            <button id="leadBtn" class="btn btn-light">
              Solicitar contacto
            </button>
          </div>

          <details class="calc">
            <summary>Simular cuotas</summary>
            <div class="calc-form">
              <label
                >Monto: <input id="monto" type="number" min="0" step="10000"
              /></label>
              <label
                >Tasa mensual (%):
                <input id="tasa" type="number" min="0" step="0.1" value="5"
              /></label>
              <label
                >Cuotas:
                <input id="cuotas" type="number" min="1" max="84" value="36"
              /></label>
              <button id="simular" class="btn btn-primary" type="button">
                Calcular
              </button>
            </div>
            <p id="cuotaRes" class="calc-res"></p>
          </details>
        </div>
      </section>

      <% if (related && related.length) { %>
      <section class="rel">
        <h2>Relacionados</h2>
        <div class="grid-cards">
          <% related.forEach(function(v){ %>
          <article class="card">
            <a
              href="/vehiculos/<%= v.id %>"
              class="thumb"
              style="
                background-image: url('<%= v.image || '/assets/img/hero-duster.jpg' %>');
              "
              aria-label="<%= v.brand + ' ' + v.model %>"
            ></a>
            <div class="body">
              <h3>
                <a href="/vehiculos/<%= v.id %>"
                  ><%= v.brand %> <%= v.model %> <%= v.year || '' %></a
                >
              </h3>
              <div class="meta">
                <% if (v.km != null) { %><span
                  ><%= v.km.toLocaleString('es-AR') %> km</span
                ><% } %> <% if (v.fuel) { %><span><%= v.fuel %></span><% } %> <%
                if (v.transmission) { %><span><%= v.transmission %></span><% }
                %>
              </div>
            </div>
          </article>
          <% }) %>
        </div>
      </section>
      <% } %>
    </main>

    <a
      href="https://wa.me/5493430000000"
      class="wa-fab"
      target="_blank"
      rel="noopener"
      aria-label="WhatsApp"
    >
      <img src="/assets/img/whatsapp.png" alt="WhatsApp" />
    </a>

    <!-- Data para el front (JSON seguro) -->
    <script id="veh-json" type="application/json">
      <%- JSON.stringify({ vehiculo, gallery, PUBLIC_URL, related }) %>
    </script>

    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/vehiculo.js"></script>
  </body>
</html>
